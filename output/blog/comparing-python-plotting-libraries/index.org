#+BEGIN_COMMENT
.. title: Comparing python plotting libraries
.. slug: comparing-python-plotting-libraries
.. date: 2017-12-23 13:33:34 UTC-06:00
.. tags: python,r,learning
.. category: 
.. link: 
.. description: 
.. type: text
#+END_COMMENT


* Introduction

As mentioned in a [[https://jwhendy.github.io/blog/translating-r-to-python/][previous post]], I've been trying to pick up `python`, coming from mostly
using `R` over the past 5-7 years for data analysis, stats, and a lot of plotting. I found
`python`'s plotting landscape quite a bit more confusing than I expected, with tons of
options compared to the typical reigning `R` champions: `base`, [[http://lattice.r-forge.r-project.org/][=lattice=]], and [[http://ggplot2.org/][=ggplot2=]]. 

Granted, there are a ton of other R contenders as well, such as [[https://plot.ly/r/][=plotly=]] and [[https://ramnathv.github.io/rCharts/][=rCharts=]],
but the three above are the most common. I stick almost exclusively to `ggplot2`, and
rarely find something I can't do (granted, this is typical science-y stuff, not
infographics or really complicated stuff). To educate myself, I went through and plotted a
pretty standard dataset in various ways to see how one would do it in a bunch of `python`
libraries:

- [[http://ggplot.yhathq.com/][=ggpy=]]
- [[https://matplotlib.org/][=matplotlib=]]
- [[https://seaborn.pydata.org/][=seaborn=]]
- [[https://plot.ly/python/][=plotly=]]
- [[https://plot.ly/ipython-notebooks/cufflinks/][=cufflinks=]]
- [[https://altair-viz.github.io/][=altair=]]
- [[https://bokeh.pydata.org/en/latest/][=bokeh=]]
- [[http://pygal.org/en/stable/][=pygal=]]

* The example

I started /really/ simple. Three types of plots: a simple bar, a dot plot (basically a
bar plot, but makes Tufte proud with a higher data:ink ratio), and a scatter plot colored
by group.

The bar chart in R:

#+begin_src R :session r :results silent :eval no

library(ggplot2)
data(mtcars)

df <- mtcars[1:5, ]
df$car <- rownames(df)

ggplot(df, aes(x = car, y = mpg)) + geom_bar(stat="identity")

#+end_src

A dot plot:

#+begin_src R :session r :results silent :eval no

ggplot(df, aes(x = car, y = mpg)) + geom_point() + expand_limits(y=0)

#+end_src

And lastly, we'll use a bit more data and do a colored scatter plot:

#+begin_src R :session r :results silent :eval no

df <- mtcars[1:10, ]
df$car <- rownames(df)

ggplot(df, aes(x = wt, y = mpg, colour = car)) + geom_point()

#+end_src

Here are our three plots:

#+begin_export html 

<table>
  <td>
    <tr>
      <a href="../../img/r_mtcars_bar.png"><img src="../../img/r_mtcars_bar.png" width="30%" /></a>
    </tr>
  </td>
  <td>
    <tr>
      <a href="../../img/r_mtcars_dot.png"><img src="../../img/r_mtcars_dot.png" width="30%" /></a>
    </tr>
  </td>
  <td>
    <tr>
      <a href="../../img/r_mtcars_scatter_color.png"><img src="../../img/r_mtcars_scatter_color.png" width="30%" /></a>
    </tr>
  </td>
</table>

#+end_export

* ggpy

Porting `ggplot2` to `python` is an /amazing/ concept. The whole idea behind the grammar
of graphics is how little the code needs to change for different visualizations. We're
only changing some mappings (some aspect of the data leads to some aesthetic) and the
geometry being used.

The above is /almost/ identical using the port for the bar chart. I dislike that the
aesthetic keyword is =weight= and not simply =y=. This [[https://github.com/yhat/ggpy/issues/373][surprised someone else]], too. It
also causes there to be no `y-axis` label by default; I had to manually add it in.

I also don't love how =ggpy= handles limits. Note the dot plot from =ggplot2= and the
nice little padding above the highest dot. In =ggpy=, this didn't seem to work well out of
the box. I could fix it with =scale_y_continuous=, but why should I have to? This also
makes for requiring what I consider hokey, like:

#+begin_example
... + scale_y_continuous(limits=(0, max(df['mpg'])*1.1))
#+end_example

I /could/ do that, but again, it's extra effort. In my own workflow, I find I'm often
visualizing some variables pretty similarly. I'll copy and paste code blocks and switch
out variable names. This is one more thing to need to remember, and perhaps the 1.1
multiplier wouldn't work so well if the data range was different by an order or two of
magnitude. Smart ranges should "just work" in my opinion.

Another complaint has to do with saving out the files. I'm not showing it below, but these
were each generated with:

#+begin_example
p = ggplot(...)
p.save('filename.png', width=w, height=h, dpi=300)
#+end_example

In `R`, I'd do something very similar:

#+begin_example
png('filename.png', width=w, height=h, res=300)
p
dev.off()
#+end_example

For the bar and dot, things were fine using ~width=9, height=6~ (inches), but using this
for the scatter seemed not to incorporate the legend in the width. Using the same size, I
got this:

#+attr_html: :width 600px
[[../../img/ggpy_mtcars_scatter_color_crunch.png]]

To get the legend to fit, I had to bump the size, but that makes the text labels much
smaller. In =ggplot=, I could fix this with some =theme()= options; I didn't get far
enough to hunt the equivalent in =ggpy=

#+begin_example 
from ggplot import *

ggplot(df, aes(x='car', weight='mpg')) + geom_bar(stat='identity') + scale_y_continuous('mpg')
#+end_example

For the dot plot, note the switch back to ~y=~:

#+begin_example 
ggplot(df, aes(x='car', y='mpg')) + geom_point() + ylim(low=0)
#+end_example

And the scatter plot:

#+begin_example  
ggplot(df, aes(x='wt', y='mpg', color='car')) + geom_point()
#+end_example

Here's what we get!

#+begin_export html 

<table>
  <td>
    <tr>
      <a href="../../img/ggpy_mtcars_bar.png"><img src="../../img/ggpy_mtcars_bar.png" width="30%" /></a>
    </tr>
  </td>
  <td>
    <tr>
      <a href="../../img/ggpy_mtcars_dot.png"><img src="../../img/ggpy_mtcars_dot.png" width="30%" /></a>
    </tr>
  </td>
  <td>
    <tr>
      <a href="../../img/ggpy_mtcars_scatter_color.png"><img src="../../img/ggpy_mtcars_scatter_color.png" width="30%" /></a>
    </tr>
  </td>
</table>

#+end_export
